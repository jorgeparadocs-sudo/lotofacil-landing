<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lotof√°cil - Confer√™ncia Autom√°tica</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
<script src="https://unpkg.com/pdfjs-dist@4.4.168/build/pdf.min.js"></script>
<script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>
<style>
html { scroll-behavior: smooth; }
section { scroll-margin-top: 80px; }
canvas { border:1px dashed #ccc; border-radius: 10px; }
</style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

<!-- Navbar -->
<nav class="fixed top-0 left-0 right-0 bg-white shadow z-50">
  <div class="max-w-6xl mx-auto px-6 py-3 flex justify-between items-center">
    <h1 class="text-xl font-bold text-indigo-600">Lotof√°cil OCR</h1>
    <div class="space-x-6">
      <a href="#home" class="hover:text-indigo-600">In√≠cio</a>
      <a href="#como" class="hover:text-indigo-600">Como Funciona</a>
      <a href="#app" class="hover:text-indigo-600">Ferramenta</a>
    </div>
  </div>
</nav>

<!-- Hero -->
<section id="home" class="pt-24 pb-16 text-center bg-gradient-to-b from-indigo-100 to-white">
  <div class="max-w-2xl mx-auto">
    <h2 class="text-4xl font-bold mb-4 text-indigo-700">Confer√™ncia Autom√°tica da Lotof√°cil</h2>
    <p class="text-gray-700 text-lg mb-6">Envie a imagem do seu bilhete e descubra instantaneamente seus jogos e acertos. Tudo direto no navegador.</p>
    <a href="#app" class="bg-indigo-600 text-white px-6 py-3 rounded-lg text-lg font-semibold hover:bg-indigo-700 transition">Conferir meu bilhete</a>
  </div>
</section>

<!-- Como Funciona -->
<section id="como" class="py-16 bg-white">
  <div class="max-w-5xl mx-auto px-6">
    <h3 class="text-2xl font-bold text-center mb-10 text-indigo-700">Como Funciona</h3>
    <div class="grid md:grid-cols-3 gap-10 text-center">
      <div><div class="text-indigo-600 text-4xl mb-3">üì∑</div><h4 class="font-semibold mb-2">Upload do Bilhete</h4><p>Envie uma imagem do seu bilhete da Lotof√°cil. O sistema detecta automaticamente os n√∫meros dos jogos.</p></div>
      <div><div class="text-indigo-600 text-4xl mb-3">üß†</div><h4 class="font-semibold mb-2">Leitura Inteligente</h4><p>Usamos <strong>Tesseract.js</strong> e <strong>jsQR</strong> para reconhecer n√∫meros diretamente da imagem, sem enviar nada para servidores externos.</p></div>
      <div><div class="text-indigo-600 text-4xl mb-3">üèÜ</div><h4 class="font-semibold mb-2">Resultados Imediatos</h4><p>O sistema identifica os jogos encontrados e exibe os n√∫meros formatados automaticamente.</p></div>
    </div>
  </div>
</section>

<!-- Ferramenta -->
<section id="app" class="py-16 bg-indigo-50">
  <div class="max-w-4xl mx-auto px-6 text-center">
    <h3 class="text-2xl font-bold mb-8 text-indigo-700">Ferramenta de Confer√™ncia</h3>

    <div class="bg-white rounded-xl shadow p-6">
      <div class="mb-4 flex flex-col md:flex-row gap-4 items-center justify-center">
        <input id="file" type="file" accept="image/*,application/pdf" class="border p-2 rounded w-full md:w-auto"/>
        <button id="run" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">Rodar OCR</button>
        <button id="clear" class="border border-gray-300 text-gray-600 px-4 py-2 rounded">Limpar</button>
      </div>

      <div><p class="text-sm text-gray-500 mb-1">Imagem do Bilhete</p><canvas id="canvas1" height="250" class="mx-auto"></canvas></div>

      <div id="output" class="mt-6 space-y-2 text-sm font-mono text-gray-800 bg-gray-50 p-4 rounded border border-gray-200 text-left"></div>
    </div>
  </div>
</section>

<!-- Rodap√© -->
<footer class="bg-white border-t mt-16 py-6 text-center text-sm text-gray-600">
  Desenvolvido por <span class="text-indigo-600 font-semibold">Jorge Farias</span> ‚Ä¢ ¬© 2025
</footer>

<script>
if(window['pdfjsLib']) pdfjsLib.GlobalWorkerOptions.workerSrc='https://unpkg.com/pdfjs-dist@4.4.168/build/pdf.worker.min.js';

const fileEl=document.getElementById('file');
const runEl=document.getElementById('run');
const clearEl=document.getElementById('clear');
const canvas1=document.getElementById('canvas1');
const output=document.getElementById('output');
let currentImageData=null;

function draw(c,img){const cx=c.getContext('2d');c.width=img.width;c.height=img.height;cx.putImageData(img,0,0);}
function toGray(imgData){
 const {data,width,height}=imgData;const out=new Uint8ClampedArray(data.length);
 for(let i=0;i<data.length;i+=4){const v=0.299*data[i]+0.587*data[i+1]+0.114*data[i+2];out[i]=out[i+1]=out[i+2]=v;out[i+3]=255;}return new ImageData(out,width,height);
}
async function loadImageData(file){
 if(file.type==='application/pdf'){
   const ab=await file.arrayBuffer();const pdf=await pdfjsLib.getDocument({data:ab}).promise;
   const page=await pdf.getPage(1);const vp=page.getViewport({scale:2});
   const c=document.createElement('canvas');const cx=c.getContext('2d');c.width=vp.width;c.height=vp.height;
   await page.render({canvasContext:cx,viewport:vp}).promise;
   return cx.getImageData(0,0,c.width,c.height);
 }else{
   const bmp=await createImageBitmap(file);const c=document.createElement('canvas');const cx=c.getContext('2d');
   c.width=bmp.width;c.height=bmp.height;cx.drawImage(bmp,0,0);
   return cx.getImageData(0,0,c.width,c.height);
 }
}
async function runOCR(img){
 const c=document.createElement('canvas');c.width=img.width;c.height=img.height;c.getContext('2d').putImageData(img,0,0);
 const dataUrl=c.toDataURL('image/png');
 const { data } = await Tesseract.recognize(dataUrl,'por',{ tessedit_pageseg_mode:6, tessedit_char_whitelist:'0123456789' });
 return data.text || '';
}
function parseGames(txt){
 const t=(txt.match(/\\d{2}/g)||[]).map(x=>parseInt(x));const games=[];let buf=[];
 for(const n of t){if(n>=1&&n<=25){buf.push(n);if(buf.length===15){games.push(buf.slice());buf=[];}}else{if(buf.length>=15&&buf.length<=20)games.push(buf.slice());buf=[];}}
 if(buf.length>=15&&buf.length<=20)games.push(buf);return games;
}
function renderGames(gs){
 output.innerHTML='';
 if(!gs.length){output.innerHTML='<span class=\"text-red-500\">N√£o foi poss√≠vel identificar jogos.</span>';return;}
 gs.forEach((g,i)=>{const div=document.createElement('div');div.textContent='Jogo '+(i+1)+': '+g.map(x=>String(x).padStart(2,'0')).join(',');output.appendChild(div);});
}

fileEl.addEventListener('change',async()=>{
 const f=fileEl.files?.[0];if(!f)return;
 currentImageData=await loadImageData(f);
 draw(canvas1,currentImageData);
});
runEl.addEventListener('click',async()=>{
 if(!currentImageData){alert('Envie uma imagem primeiro.');return;}
 const gray=toGray(currentImageData);
 const text=await runOCR(gray);
 const games=parseGames(text);
 renderGames(games);
});
clearEl.addEventListener('click',()=>{output.innerHTML='';canvas1.getContext('2d').clearRect(0,0,canvas1.width,canvas1.height);fileEl.value='';currentImageData=null;});
</script>
</body>
</html>